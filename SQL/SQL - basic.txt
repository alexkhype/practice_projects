INTRODUCTION TO SQL

SELECT DISTINCT category AS unique_categories
FROM products
ORDER BY rating DESC
LIMIT 10;

    SELECT specifies which columns to retrieve
    it's a _best practice_ to only select the columns you actually need

    DISTINCT (optional) is placed immediately after SELECT
    It identifies and returns only the unique values from the column

    AS assigns a new display name to the column that precedes it
    the alias appears in the column header of your results
    useful when building reports or when clearer column names for analysis are needed

    FROM products tells SQL to get the data from the products table
    ; is the statement terminator—it marks the end of your command

    ORDER BY sorts the results by the column, lowest to highest

    DESC sorts the results by the column, highest to lowest
    goes right after the column name (because that is what you're sorting)

    LIMIT keyword to restrict the number of rows returned.





INTERMEDIATE SQL

######################
### Selecting Data ###
######################

SELECT COUNT(*) AS total_records
FROM people;   
    
    COUNT(*) tells you how many records are in a table.

SELECT COUNT(birthdate) AS count_birthdates
FROM people;

    COUNT(field) counts the number of non-missing values in a particular field

SELECT COUNT(name) AS count_names, COUNT(birthdate) AS count_birthdates
FROM people;

    To count more than one field, we need to use COUNT multiple times.

SELECT COUNT(DISTINCT birthdate) AS count_distinct_birthdates
FROM people;

    Combining COUNT with DISTINCT counts the number of unique values in a field. 



#########################
### Filtering Records ###
#########################

**Check Holywell's style guide: https://www.sqlstyle.guide/

SELECT "release year"
FROM films;

    " "  indicate that, despite being two words, the name refers to just one field

SELECT title
FROM films
WHERE release_year > 1960;

    WHERE filters data that fulfills a condition
    comes after the FROM statement, but before LIMIT

SELECT title
FROM films
WHERE release_year <> 1960;

    <, >, <=, >=, =
    <> means "except" (!=). e.g. show all the titles except those released in 1960

SELECT title
FROM films
WHERE country = 'Japan';

    'string' only single quotations

-- Select film_id and imdb_score with an imdb_score over 7.0
SELECT film_id, imdb_score
FROM reviews
WHERE imdb_score > 7.0;

-- Select film_id and facebook_likes for ten records with less than 1000 likes 
SELECT film_id, facebook_likes
FROM reviews
WHERE facebook_likes < 1000
LIMIT 10;

-- Count the records with at least 100,000 votes
SELECT COUNT(*) AS films_over_100K_votes
FROM reviews
WHERE num_votes >= 100000;

-- Count the Spanish-language films
SELECT COUNT(language) AS count_spanish
FROM films
WHERE language = 'Spanish';

SELECT *
FROM coats
WHERE color = 'yellow' OR length = 'short';

    OR satisfies at least one condition in out filter
    combined with WHERE
    specify the field for every OR condition

SELECT *
FROM coats
WHERE color = 'yellow' AND length = 'short';

    AND satisfies all criteria in our filter
    combined with WHERE
    specify the field for every AND condition


SELECT title
FROM films
WHERE (release_year = 1994 OR release_year = 1995)
    AND (certification = 'PG' OR certification = 'R');

    If a query has multiple filtering conditions, we will need to enclose the individual 
    clauses in parentheses to ensure the correct execution order

SELECT *
FROM coats
WHERE buttons BETWEEN 1 AND 5;

    BETWEEN filters values within a specified range. 
    combined with WHERE

-- Select the title and release_year for all German-language films released before 2000
SELECT title, release_year
FROM films
WHERE language = 'German'
    AND release_year < 2000;

-- Select all records for German-language films released after 2000 and before 2010
SELECT *
FROM films
WHERE language = 'German'
    AND (release_year > 2000 AND release_year < 2010);

-- Select the title and release_year of films released in 1990 or 1999, 
which were in English or Spanish and took in more than $2,000,000 gross.

SELECT title, release_year
FROM films
WHERE (release_year = 1990 OR release_year = 1999)
	AND (language = 'English' OR language = 'Spanish')
	AND (gross > 2000000);

-- Select the title and release_year of all Spanish or French-language films released 
between 1990 and 2000 (inclusive) with budgets over $100 million.

SELECT title, release_year
FROM films
WHERE release_year BETWEEN 1990 AND 2000
	AND budget > 100000000
	AND (language = 'Spanish' OR language = 'French');

SELECT name
FROM people
WHERE name LIKE 'Ade%';

    LIKE (with WHERE) searches for a pattern in a field
    we can use a wildcard as a placeholder for some other values 
        % will match zero, one, or many characters in the text.
        _ will match a single character

SELECT name
FROM people
WHERE name NOT LIKE 'A.%';

SELECT name
FROM people
WHERE name LIKE '%r';

SELECT name
FROM people
WHERE name LIKE '__t%';

SELECT title
FROM films
WHERE release_year IN (1920, 1930, 1940);

    IN allows us to specify multiple values instead of numerous OR 

SELECT title
FROM films
WHERE title IN ('Germany', 'France');

-- Select the names that start with B
SELECT name
FROM people
WHERE name LIKE 'B%';

-- Select the names that have r as the second letter
SELECT name
FROM people
WHERE name LIKE '_r%';

-- Select names that don't start with A
SELECT name
FROM people
WHERE name NOT LIKE 'A%';

-- Find the title and release_year for all films over two hours in length released in 1990 and 2000
SELECT title, release_year
FROM films
WHERE (duration > 120)
    AND release_year IN (1990, 2000); 

-- Find the title and release_year for all films over two hours in length released in 1990 and 2000
SELECT title, release_year
FROM films
WHERE (duration > 120)
    AND release_year IN (1990, 2000); 

-- Find the title and language of all films in English, Spanish, and French
SELECT title, language
FROM films
WHERE language IN ('English','Spanish','French');

-- Find the title, certification, and language all films certified NC-17 or R that are in English, Italian, or Greek
SELECT title, certification, language
FROM films
WHERE certification IN ('NC-17','R')
    AND language IN ('English','Italian','Greek');

-- Count the unique titles
SELECT COUNT(DISTINCT title) AS nineties_english_films_for_teens
FROM films
-- Filter to release_years to between 1990 and 1999
WHERE release_year BETWEEN 1990 AND 1999
-- Filter to English-language films
	AND language = 'English'
-- Narrow it down to G, PG, and PG-13 certifications
	AND certification IN ('G','PG','PG-13');

SELECT name
FROM people
WHERE birthdate IS NULL;

SELECT COUNT(*) AS no_birthdates
FROM people
WHERE birthdate IS NULL;

SELECT COUNT(name) AS count_birthdates
FROM people
WHERE birthdate IS NOT NULL;

-- List all film titles with missing budgets
SELECT title AS no_budget_info
FROM films
WHERE budget IS NULL;

-- Count the number of films we have language data for
SELECT COUNT(title) AS count_language_known
FROM films
WHERE language IS NOT NULL;



###########################
### Aggregate Functions ###
###########################

    An aggregate function performs a calculation on several values and returns a single value. 
    Come after SELECT
    It's best practice to use an alias when summarizing data so that results are clear to read

    AVG() - numerical
    SUM() - numerical
    COUNT() - various types
    MIN() - various types (with strings, it's alphabetical order)
    MAX() - various types

SELECT AVG(budget)
FROM films;

SELECT SUM(budget)
FROM films;

SELECT MIN(budget)
FROM films;

SELECT MAX(budget)
FROM films;

-- Query the sum of film durations
SELECT SUM(duration) AS total_duration
FROM films;

-- Calculate the average duration of all films
SELECT AVG(duration) AS average_duration
FROM films;

-- Find the latest release_year
SELECT MAX(release_year) AS latest_year
FROM films;

-- Find the duration of the shortest film
SELECT MIN(duration) AS shortest_film
FROM films;

SELECT ROUND(AVG(budget), 2) AS avg_budget
FROM films
WHERE release_year >= 2010; 

    ROUND() to round our number to a specified decimal
    The second parameter is a number
    A negative number will round to the left of the decimal point 
    Only numerical fields. 

-- Calculate the sum of gross from the year 2000 or later
SELECT SUM(gross) AS total_gross
FROM films
WHERE release_year >= 2000

-- Calculate the average gross of films that start with A
SELECT AVG(gross) AS avg_gross_A
FROM films
WHERE title LIKE 'A%';

-- Calculate the lowest gross film in 1994
SELECT MIN(gross) AS lowest_gross
FROM films
WHERE release_year = 1994;

-- Calculate the highest gross film released between 2000-2012
SELECT MAX(gross) AS highest_gross
FROM films
WHERE release_year BETWEEN 2000 AND 2012;

-- Round the average number of facebook_likes to one decimal place
SELECT ROUND(AVG(facebook_likes), 1) AS avg_facebook_likes
FROM reviews;

-- Calculate the average budget rounded to the thousands
SELECT ROUND(AVG(budget), -3) AS avg_budget_thousands
FROM films

SELECT (4/3)
SELECT (4.0 / 3.0)

    The first result is an integer
    The second result is a float

SELECT (gross - budget) AS profit
FROM films;

-- Calculate the title and duration_hours from films
SELECT title, ROUND((duration / 60.0), 2) AS duration_hours
FROM films;

-- Calculate the percentage of people who are no longer alive
SELECT COUNT(deathdate) * 100.0 / COUNT(*) AS percentage_dead
FROM people;

-- Find the number of decades in the films table
SELECT (MAX(release_year) - MIN(release_year)) / 10.0 AS number_of_decades
FROM films;



################################
###   Sorting and Grouping   ###
################################

SELECT title, budget
FROM films
ORDER BY budget DESC;

    ORDER BY sorts by ascend order by default
    Can be used in more than one field, will sort by the first, and then the next
    After FROM, WHERE, GROUP BY statements, before LIMIT
        ASC clarifies ascending order 
        DESC clarifiest descending order 

-- Select name from people and sort alphabetically
SELECT name
FROM people
ORDER BY name ASC;

-- Select the title and duration from longest to shortest film
SELECT title, duration
FROM films
ORDER BY duration DESC;

-- Select the certification, release year, and title sorted by certification and release year
SELECT certification, release_year, title
FROM films
ORDER BY certification ASC,
    release_year DESC;

SELECT certification, COUNT(title) AS title_count
FROM films
GROUP BY certification

    GROUP BY is commonly used with aggregate functions to provide summary statistics
    Can be used on multiple fields
    We cannot filter aggregate functions with WHERE clauses
    GROUP has its filtering word HAVING
    SQL will return an error if we try to SELECT a field that is not in our GROUP BY clause

        SELECT certification, title
        FROM films
        GROUP BY certification

        Aquí no sabe qué hacer con title, por eso manda error

-- Find the release_year and film_count of each year
SELECT release_year, COUNT(title) AS film_count
FROM films
GROUP BY release_year;

-- Find the release_year and average duration of films for each year
SELECT release_year, AVG(duration) AS avg_duration
FROM films
GROUP BY release_year;

-- Find the release_year, country, and max_budget, then group and order by release_year and country
SELECT release_year, country, MAX(budget) AS max_budget
FROM films
GROUP BY release_year, country
ORDER BY release_year, country;

-- Using the films table: which release_year had the most language diversity?
SELECT 
    release_year, 
    COUNT(DISTINCT language) AS number_lang
FROM films
GROUP BY release_year
ORDER BY number_lang DESC
LIMIT 1;

SELECT
    release_year,
    COUNT(title) AS title_count
FROM films
GROUP BY release year
HAVING COUNT(title) > 10;

    WHERE filters individual records
    HAVING filters grouped records

-- Select the country and distinct count of certification as certification_count
SELECT 
    country, 
    COUNT(DISTINCT certification) AS certification_count
FROM films
-- Group by country
GROUP BY country
-- Filter results to countries with more than 10 different certifications
HAVING COUNT(DISTINCT certification) > 10

-- Select the country and average_budget from films
SELECT country, AVG(budget) AS average_budget
FROM films
-- Group by country
GROUP BY country
-- Filter to countries with an average_budget of more than one billion
HAVING AVG(budget) > 1000000000
-- Order by descending order of the aggregated budget
ORDER BY AVG(budget) DESC;

-- Write a query that returns the films with the highest gross earnings average with an average budget greater than 60 million for films after 1990.
SELECT 
    release_year, 
    AVG(budget) AS avg_budget, 
    AVG(gross) AS avg_gross
FROM films
WHERE release_year > 1990
GROUP BY release_year
HAVING AVG(budget) > 60000000
ORDER BY AVG(gross) DESC
LIMIT 1;

COUNT()
LIMIT
WHERE
BETWEEN
AND
OR
LIKE
NOT LIKE
IN
%
_
IS NULL
IS NOT NULL
ROUND
AVG()
SUM()
MAX()
MIN()
ORDER BY
DESC
ASC
GROUP BY
HAVING





#######################
###  WRITTEN ORDER  ###
#######################

1. SELECT  
       COUNT()
       AS 
2. FROM
3. WHERE x
       IN () 
4. GROUP BY
5. HAVING COUNT()
6. ORDER BY
7. LIMIT

##########################
### ORDER OF EXECUTION ###
##########################

1. FROM
2. WHERE
3. GROUP BY
4. HAVING 
5. SELECT
6. ORDER BY
7. LIMIT
